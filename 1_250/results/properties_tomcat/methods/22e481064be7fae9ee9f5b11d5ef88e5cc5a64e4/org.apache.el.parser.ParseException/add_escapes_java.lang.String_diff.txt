/**                                                                                                    /**                                                                                                 
* Used to convert raw characters to their escaped version                                              * Used to convert raw characters to their escaped version                                           
* when these raw version cannot be used as part of an ASCII                                            * when these raw version cannot be used as part of an ASCII                                         
* string literal.                                                                                      * string literal.                                                                                   
*/                                                                                                     */                                                                                                  
static String add_escapes(String str) {                                                                static String add_escapes(String str) {                                                             
StringBuffer retval = new StringBuffer();                                                            | StringBuilder retval = new StringBuilder();                                                         
char ch;                                                                                               char ch;                                                                                            
for (int i = 0; i &lt; str.length(); i++) {                                                            for (int i = 0; i &lt; str.length(); i++) {                                                         
switch(str.charAt(i)) {                                                                                switch(str.charAt(i)) {                                                                             
case 0:                                                                                              |                                                                                                     
continue;                                                                                            |                                                                                                     
case '\b':                                                                                             case '\b':                                                                                          
retval.append("\\b");                                                                                  retval.append("\\b");                                                                               
continue;                                                                                              continue;                                                                                           
case '\t':                                                                                             case '\t':                                                                                          
retval.append("\\t");                                                                                  retval.append("\\t");                                                                               
continue;                                                                                              continue;                                                                                           
case '\n':                                                                                             case '\n':                                                                                          
retval.append("\\n");                                                                                  retval.append("\\n");                                                                               
continue;                                                                                              continue;                                                                                           
case '\f':                                                                                             case '\f':                                                                                          
retval.append("\\f");                                                                                  retval.append("\\f");                                                                               
continue;                                                                                              continue;                                                                                           
case '\r':                                                                                             case '\r':                                                                                          
retval.append("\\r");                                                                                  retval.append("\\r");                                                                               
continue;                                                                                              continue;                                                                                           
case '\"':                                                                                             case '\"':                                                                                          
retval.append("\\\"");                                                                                 retval.append("\\\"");                                                                              
continue;                                                                                              continue;                                                                                           
case '\'':                                                                                             case '\'':                                                                                          
retval.append("\\\'");                                                                                 retval.append("\\\'");                                                                              
continue;                                                                                              continue;                                                                                           
case '\\':                                                                                             case '\\':                                                                                          
retval.append("\\\\");                                                                                 retval.append("\\\\");                                                                              
continue;                                                                                              continue;                                                                                           
default:                                                                                               default:                                                                                            
if ((ch = str.charAt(i)) &lt; 0x20 || ch &gt; 0x7e) {                                                  if ((ch = str.charAt(i)) &lt; 0x20 || ch &gt; 0x7e) {                                               
String s = "0000" + Integer.toString(ch, 16);                                                          String s = "0000" + Integer.toString(ch, 16);                                                       
retval.append("\\u" + s.substring(s.length() - 4, s.length()));                                      | retval.append("\\u" + s.substring(s.length() - 4));                                                 
} else {                                                                                               } else {                                                                                            
retval.append(ch);                                                                                     retval.append(ch);                                                                                  
}                                                                                                      }                                                                                                   
continue;                                                                                              continue;                                                                                           
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
return retval.toString();                                                                              return retval.toString();                                                                           
}                                                                                                      }                                                                                                   
