@Test                                                                                                  @Test                                                                                               
public void testPasswordValidationCallback() throws Exception {                                        public void testPasswordValidationCallback() throws Exception {                                     
CallbackHandler callbackHandler = createCallbackHandler(null);                                         CallbackHandler callbackHandler = createCallbackHandler(null);                                      
Container container = new TestContainer();                                                             Container container = new TestContainer();                                                          
container.setRealm(new TestRealm());                                                                   container.setRealm(new TestRealm());                                                                
((Contained) callbackHandler).setContainer(container);                                                 ((Contained) callbackHandler).setContainer(container);                                              
Subject clientSubject = new Subject();                                                                 Subject clientSubject = new Subject();                                                              
PasswordValidationCallback pvc1 = new PasswordValidationCallback(clientSubject, "name1", "password".   PasswordValidationCallback pvc1 = new PasswordValidationCallback(clientSubject, "name1", "password".
callbackHandler.handle(new Callback[] { pvc1 });                                                       callbackHandler.handle(new Callback[] { pvc1 });                                                    
                                                                                                     | Assert.assertTrue(pvc1.getResult());                                                                
PasswordValidationCallback pvc2 = new PasswordValidationCallback(clientSubject, "name2", "invalid".t   PasswordValidationCallback pvc2 = new PasswordValidationCallback(clientSubject, "name2", "invalid".t
callbackHandler.handle(new Callback[] { pvc2 });                                                       callbackHandler.handle(new Callback[] { pvc2 });                                                    
                                                                                                     | Assert.assertFalse(pvc2.getResult());                                                               
Set&lt;Object&gt; credentials = clientSubject.getPrivateCredentials();                                 Set&lt;Object&gt; credentials = clientSubject.getPrivateCredentials();                              
Assert.assertTrue(credentials.size() == 1);                                                            Assert.assertTrue(credentials.size() == 1);                                                         
GenericPrincipal gp = (GenericPrincipal) credentials.iterator().next();                                GenericPrincipal gp = (GenericPrincipal) credentials.iterator().next();                             
Assert.assertEquals("name1", gp.getName());                                                            Assert.assertEquals("name1", gp.getName());                                                         
}                                                                                                      }                                                                                                   
