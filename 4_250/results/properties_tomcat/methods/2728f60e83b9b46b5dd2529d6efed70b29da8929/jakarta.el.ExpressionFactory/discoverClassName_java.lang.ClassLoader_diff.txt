/**                                                                                                    /**                                                                                                 
* Discover the name of class that implements ExpressionFactory.                                        * Discover the name of class that implements ExpressionFactory.                                     
*                                                                                                      *                                                                                                   
* @param tccl                                                                                          * @param tccl                                                                                       
*            {@code ClassLoader}                                                                       *            {@code ClassLoader}                                                                    
* @return Class name. There is default, so it is never {@code null}.                                   * @return Class name. There is default, so it is never {@code null}.                                
*/                                                                                                     */                                                                                                  
private static String discoverClassName(ClassLoader tccl) {                                            private static String discoverClassName(ClassLoader tccl) {                                         
String className = null;                                                                               String className = null;                                                                            
// First services API                                                                                  // First services API                                                                               
className = getClassNameServices(tccl);                                                                className = getClassNameServices(tccl);                                                             
if (className == null) {                                                                               if (className == null) {                                                                            
if (IS_SECURITY_ENABLED) {                                                                             if (IS_SECURITY_ENABLED) {                                                                          
className = AccessController.doPrivileged(new PrivilegedAction&lt;String&gt;() {                     | className = AccessController.doPrivileged((PrivilegedAction&lt;String&gt;) ExpressionFactory::getCla
                                                                                                                                                                                                           
@Override                                                                                            |                                                                                                     
public String run() {                                                                                |                                                                                                     
return getClassNameJreDir();                                                                         |                                                                                                     
}                                                                                                    |                                                                                                     
});                                                                                                  |                                                                                                     
} else {                                                                                               } else {                                                                                            
// Second el.properties file                                                                           // Second el.properties file                                                                        
className = getClassNameJreDir();                                                                      className = getClassNameJreDir();                                                                   
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
if (className == null) {                                                                               if (className == null) {                                                                            
if (IS_SECURITY_ENABLED) {                                                                             if (IS_SECURITY_ENABLED) {                                                                          
className = AccessController.doPrivileged(new PrivilegedAction&lt;String&gt;() {                     | className = AccessController.doPrivileged((PrivilegedAction&lt;String&gt;) ExpressionFactory::getCla
                                                                                                                                                                                                           
@Override                                                                                            |                                                                                                     
public String run() {                                                                                |                                                                                                     
return getClassNameSysProp();                                                                        |                                                                                                     
}                                                                                                    |                                                                                                     
});                                                                                                  |                                                                                                     
} else {                                                                                               } else {                                                                                            
// Third system property                                                                               // Third system property                                                                            
className = getClassNameSysProp();                                                                     className = getClassNameSysProp();                                                                  
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
if (className == null) {                                                                               if (className == null) {                                                                            
// Fourth - default                                                                                    // Fourth - default                                                                                 
className = "org.apache.el.ExpressionFactoryImpl";                                                     className = "org.apache.el.ExpressionFactoryImpl";                                                  
}                                                                                                      }                                                                                                   
return className;                                                                                      return className;                                                                                   
}                                                                                                      }                                                                                                   
