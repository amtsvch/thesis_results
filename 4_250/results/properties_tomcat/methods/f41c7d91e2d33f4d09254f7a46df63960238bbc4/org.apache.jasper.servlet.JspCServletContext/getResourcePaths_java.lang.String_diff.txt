/**                                                                                                    /**                                                                                                 
* Return the set of resource paths for the "directory" at the                                          * Return the set of resource paths for the "directory" at the                                       
* specified context path.                                                                              * specified context path.                                                                           
*                                                                                                      *                                                                                                   
* @param path Context-relative base path                                                               * @param path Context-relative base path                                                            
*/                                                                                                     */                                                                                                  
@Override                                                                                              @Override                                                                                           
public Set&lt;String&gt; getResourcePaths(String path) {                                               public Set&lt;String&gt; getResourcePaths(String path) {                                            
Set&lt;String&gt; thePaths = new HashSet&lt;&gt;();                                                    Set&lt;String&gt; thePaths = new HashSet&lt;&gt;();                                                 
if (!path.endsWith("/")) {                                                                             if (!path.endsWith("/")) {                                                                          
path += "/";                                                                                           path += "/";                                                                                        
}                                                                                                      }                                                                                                   
String basePath = getRealPath(path);                                                                   String basePath = getRealPath(path);                                                                
if (basePath != null) {                                                                                if (basePath != null) {                                                                             
File theBaseDir = new File(basePath);                                                                  File theBaseDir = new File(basePath);                                                               
if (theBaseDir.isDirectory()) {                                                                        if (theBaseDir.isDirectory()) {                                                                     
String[] theFiles = theBaseDir.list();                                                                 String[] theFiles = theBaseDir.list();                                                              
if (theFiles != null) {                                                                                if (theFiles != null) {                                                                             
for (String theFile : theFiles) {                                                                      for (String theFile : theFiles) {                                                                   
File testFile = new File(basePath + File.separator + theFile);                                         File testFile = new File(basePath + File.separator + theFile);                                      
if (testFile.isFile()) {                                                                               if (testFile.isFile()) {                                                                            
thePaths.add(path + theFile);                                                                          thePaths.add(path + theFile);                                                                       
} else if (testFile.isDirectory()) {                                                                   } else if (testFile.isDirectory()) {                                                                
thePaths.add(path + theFile + "/");                                                                    thePaths.add(path + theFile + "/");                                                                 
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
// During initialisation, getResourcePaths() is called before                                          // During initialisation, getResourcePaths() is called before                                       
// resourceJARs is initialised                                                                         // resourceJARs is initialised                                                                      
if (resourceJARs != null) {                                                                            if (resourceJARs != null) {                                                                         
String jarPath = "META-INF/resources" + path;                                                          String jarPath = "META-INF/resources" + path;                                                       
for (URL jarUrl : resourceJARs) {                                                                      for (URL jarUrl : resourceJARs) {                                                                   
try (Jar jar = JarFactory.newInstance(jarUrl)) {                                                       try (Jar jar = JarFactory.newInstance(jarUrl)) {                                                    
jar.nextEntry();                                                                                       jar.nextEntry();                                                                                    
for (String entryName = jar.getEntryName(); entryName != null; jar.nextEntry(), entryName = jar.getE   for (String entryName = jar.getEntryName(); entryName != null; jar.nextEntry(), entryName = jar.getE
if (entryName.startsWith(jarPath) && entryName.length() &gt; jarPath.length()) {                       if (entryName.startsWith(jarPath) && entryName.length() &gt; jarPath.length()) {                    
// Let the Set implementation handle duplicates                                                        // Let the Set implementation handle duplicates                                                     
int sep = entryName.indexOf("/", jarPath.length());                                                  | int sep = entryName.indexOf('/', jarPath.length());                                                 
if (sep &lt; 0) {                                                                                      if (sep &lt; 0) {                                                                                   
// This is a file - strip leading "META-INF/resources"                                                 // This is a file - strip leading "META-INF/resources"                                              
thePaths.add(entryName.substring(18));                                                                 thePaths.add(entryName.substring(18));                                                              
} else {                                                                                               } else {                                                                                            
// This is a directory - strip leading "META-INF/resources"                                            // This is a directory - strip leading "META-INF/resources"                                         
thePaths.add(entryName.substring(18, sep + 1));                                                        thePaths.add(entryName.substring(18, sep + 1));                                                     
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
} catch (IOException e) {                                                                              } catch (IOException e) {                                                                           
log(e.getMessage(), e);                                                                                log(e.getMessage(), e);                                                                             
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
return thePaths;                                                                                       return thePaths;                                                                                    
}                                                                                                      }                                                                                                   
