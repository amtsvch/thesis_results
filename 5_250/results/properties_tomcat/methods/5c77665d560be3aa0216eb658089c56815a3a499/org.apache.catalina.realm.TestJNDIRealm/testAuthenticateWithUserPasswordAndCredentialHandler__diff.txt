@Test                                                                                                  @Test                                                                                               
public void testAuthenticateWithUserPasswordAndCredentialHandler() throws Exception {                  public void testAuthenticateWithUserPasswordAndCredentialHandler() throws Exception {               
// GIVEN                                                                                               // GIVEN                                                                                            
JNDIRealm realm = buildRealm(ha1());                                                                   JNDIRealm realm = buildRealm(ha1());                                                                
realm.setCredentialHandler(buildCredentialHandler());                                                  realm.setCredentialHandler(buildCredentialHandler());                                               
realm.setUserPassword(USER_PASSWORD_ATTR);                                                             realm.setUserPassword(USER_PASSWORD_ATTR);                                                          
// WHEN                                                                                                // WHEN                                                                                             
String expectedResponse = MD5Encoder.encode(md5Helper.digest((ha1() + ":" + NONCE + ":" + HA2).getBy   String expectedResponse = MD5Encoder.encode(md5Helper.digest((ha1() + ":" + NONCE + ":" + HA2).getBy
Principal principal = realm.authenticate(USER, expectedResponse, NONCE, null, null, null, REALM, HA2   Principal principal = realm.authenticate(USER, expectedResponse, NONCE, null, null, null, REALM, HA2
// THEN                                                                                                // THEN                                                                                             
Assert.assertTrue(principal instanceof GenericPrincipal);                                            | assertThat(principal, instanceOf(GenericPrincipal.class));                                          
Assert.assertEquals(USER, principal.getName());                                                        Assert.assertEquals(USER, principal.getName());                                                     
}                                                                                                      }                                                                                                   
