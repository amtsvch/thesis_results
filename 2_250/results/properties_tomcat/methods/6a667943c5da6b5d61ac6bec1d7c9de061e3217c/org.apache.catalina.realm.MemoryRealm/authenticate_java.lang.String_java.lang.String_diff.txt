// --------------------------------------------------------- Public Methods                            // --------------------------------------------------------- Public Methods                         
/**                                                                                                    /**                                                                                                 
* Return the Principal associated with the specified username and                                      * Return the Principal associated with the specified username and                                   
* credentials, if there is one; otherwise return &lt;code&gt;null&lt;/code&gt;.                        * credentials, if there is one; otherwise return &lt;code&gt;null&lt;/code&gt;.                     
*                                                                                                      *                                                                                                   
* @param username Username of the Principal to look up                                                 * @param username Username of the Principal to look up                                              
* @param credentials Password or other credentials to use in                                           * @param credentials Password or other credentials to use in                                        
*  authenticating this username                                                                        *  authenticating this username                                                                     
* @return the associated principal, or &lt;code&gt;null&lt;/code&gt; if there is none.                 * @return the associated principal, or &lt;code&gt;null&lt;/code&gt; if there is none.              
*/                                                                                                     */                                                                                                  
@Override                                                                                              @Override                                                                                           
public Principal authenticate(String username, String credentials) {                                   public Principal authenticate(String username, String credentials) {                                
// No user or no credentials                                                                           // No user or no credentials                                                                        
// Can't possibly authenticate, don't bother the database then                                         // Can't possibly authenticate, don't bother the database then                                      
if (username == null || credentials == null) {                                                         if (username == null || credentials == null) {                                                      
if (log.isDebugEnabled())                                                                            | if (log.isDebugEnabled()) {                                                                         
log.debug(sm.getString("memoryRealm.authenticateFailure", username));                                  log.debug(sm.getString("memoryRealm.authenticateFailure", username));                               
                                                                                                     | }                                                                                                   
return null;                                                                                           return null;                                                                                        
}                                                                                                      }                                                                                                   
GenericPrincipal principal = principals.get(username);                                                 GenericPrincipal principal = principals.get(username);                                              
String password = null;                                                                                String password = null;                                                                             
if (principal != null) {                                                                               if (principal != null) {                                                                            
password = this.credentials.get(username);                                                             password = this.credentials.get(username);                                                          
}                                                                                                      }                                                                                                   
if (principal == null || password == null) {                                                           if (principal == null || password == null) {                                                        
// User was not found in the database or the password was null                                         // User was not found in the database or the password was null                                      
// Waste a bit of time as not to reveal that the user does not exist.                                  // Waste a bit of time as not to reveal that the user does not exist.                               
getCredentialHandler().mutate(credentials);                                                            getCredentialHandler().mutate(credentials);                                                         
if (log.isDebugEnabled())                                                                            | if (log.isDebugEnabled()) {                                                                         
log.debug(sm.getString("memoryRealm.authenticateFailure", username));                                  log.debug(sm.getString("memoryRealm.authenticateFailure", username));                               
                                                                                                     | }                                                                                                   
return null;                                                                                           return null;                                                                                        
}                                                                                                      }                                                                                                   
boolean validated = getCredentialHandler().matches(credentials, password);                             boolean validated = getCredentialHandler().matches(credentials, password);                          
if (validated) {                                                                                       if (validated) {                                                                                    
if (log.isDebugEnabled())                                                                            | if (log.isDebugEnabled()) {                                                                         
log.debug(sm.getString("memoryRealm.authenticateSuccess", username));                                  log.debug(sm.getString("memoryRealm.authenticateSuccess", username));                               
                                                                                                     | }                                                                                                   
return principal;                                                                                      return principal;                                                                                   
} else {                                                                                               } else {                                                                                            
if (log.isDebugEnabled())                                                                            | if (log.isDebugEnabled()) {                                                                         
log.debug(sm.getString("memoryRealm.authenticateFailure", username));                                  log.debug(sm.getString("memoryRealm.authenticateFailure", username));                               
                                                                                                     | }                                                                                                   
return null;                                                                                           return null;                                                                                        
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
