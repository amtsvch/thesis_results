@Override                                                                                              @Override                                                                                           
public void setResources(WebResourceRoot resources) {                                                  public void setResources(WebResourceRoot resources) {                                               
Lock writeLock = resourcesLock.writeLock();                                                            Lock writeLock = resourcesLock.writeLock();                                                         
writeLock.lock();                                                                                      writeLock.lock();                                                                                   
WebResourceRoot oldResources = null;                                                                   WebResourceRoot oldResources = null;                                                                
try {                                                                                                  try {                                                                                               
if (getState().isAvailable()) {                                                                        if (getState().isAvailable()) {                                                                     
throw new IllegalStateException(sm.getString("standardContext.resourcesStart"));                       throw new IllegalStateException(sm.getString("standardContext.resourcesStart"));                    
}                                                                                                      }                                                                                                   
oldResources = this.resources;                                                                         oldResources = this.resources;                                                                      
if (oldResources == resources)                                                                       | if (oldResources == resources) {                                                                    
return;                                                                                                return;                                                                                             
                                                                                                     | }                                                                                                   
this.resources = resources;                                                                            this.resources = resources;                                                                         
if (oldResources != null) {                                                                            if (oldResources != null) {                                                                         
oldResources.setContext(null);                                                                         oldResources.setContext(null);                                                                      
}                                                                                                      }                                                                                                   
if (resources != null) {                                                                               if (resources != null) {                                                                            
resources.setContext(this);                                                                            resources.setContext(this);                                                                         
}                                                                                                      }                                                                                                   
support.firePropertyChange("resources", oldResources, resources);                                      support.firePropertyChange("resources", oldResources, resources);                                   
} finally {                                                                                            } finally {                                                                                         
writeLock.unlock();                                                                                    writeLock.unlock();                                                                                 
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
