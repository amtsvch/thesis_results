@Before                                                                                                @Before                                                                                             
public void setUp() throws Exception {                                                                 public void setUp() throws Exception {                                                              
System.out.println("Setup");                                                                           System.out.println("Setup");                                                                        
channels = new GroupChannel[channelCount];                                                             channels = new GroupChannel[channelCount];                                                          
orderitcs = new OrderInterceptor[channelCount];                                                        orderitcs = new OrderInterceptor[channelCount];                                                     
mangleitcs = new MangleOrderInterceptor[channelCount];                                                 mangleitcs = new MangleOrderInterceptor[channelCount];                                              
test = new TestListener[channelCount];                                                                 test = new TestListener[channelCount];                                                              
threads = new Thread[channelCount];                                                                    threads = new Thread[channelCount];                                                                 
for (int i = 0; i &lt; channelCount; i++) {                                                            for (int i = 0; i &lt; channelCount; i++) {                                                         
channels[i] = new GroupChannel();                                                                      channels[i] = new GroupChannel();                                                                   
orderitcs[i] = new OrderInterceptor();                                                                 orderitcs[i] = new OrderInterceptor();                                                              
mangleitcs[i] = new MangleOrderInterceptor();                                                          mangleitcs[i] = new MangleOrderInterceptor();                                                       
orderitcs[i].setExpire(Long.MAX_VALUE);                                                                orderitcs[i].setExpire(Long.MAX_VALUE);                                                             
channels[i].addInterceptor(orderitcs[i]);                                                              channels[i].addInterceptor(orderitcs[i]);                                                           
channels[i].addInterceptor(mangleitcs[i]);                                                             channels[i].addInterceptor(mangleitcs[i]);                                                          
test[i] = new TestListener(i);                                                                         test[i] = new TestListener(i);                                                                      
channels[i].addChannelListener(test[i]);                                                               channels[i].addChannelListener(test[i]);                                                            
final int j = i;                                                                                       final int j = i;                                                                                    
threads[i] = new Thread() {                                                                            threads[i] = new Thread() {                                                                         
                                                                                                                                                                                                           
@Override                                                                                              @Override                                                                                           
public void run() {                                                                                    public void run() {                                                                                 
try {                                                                                                  try {                                                                                               
channels[j].start(Channel.DEFAULT);                                                                    channels[j].start(Channel.DEFAULT);                                                                 
Thread.sleep(50);                                                                                      Thread.sleep(50);                                                                                   
} catch (Exception x) {                                                                                } catch (Exception x) {                                                                             
x.printStackTrace();                                                                                   x.printStackTrace();                                                                                
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
};                                                                                                     };                                                                                                  
}                                                                                                      }                                                                                                   
TesterUtil.addRandomDomain(channels);                                                                  TesterUtil.addRandomDomain(channels);                                                               
for (int i = 0; i &lt; channelCount; i++) threads[i].start();                                        | for (int i = 0; i &lt; channelCount; i++) {                                                         
for (int i = 0; i &lt; channelCount; i++) threads[i].join();                                         | threads[i].start();                                                                                 
                                                                                                     | }                                                                                                   
                                                                                                     | for (int i = 0; i &lt; channelCount; i++) {                                                         
                                                                                                     | threads[i].join();                                                                                  
                                                                                                     | }                                                                                                   
Thread.sleep(1500);                                                                                    Thread.sleep(1500);                                                                                 
}                                                                                                      }                                                                                                   
