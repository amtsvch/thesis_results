@Test                                                                                                  @Test                                                                                               
public void testMemberArrival() throws Exception {                                                     public void testMemberArrival() throws Exception {                                                  
// purpose of this test is to make sure that we have received all the members                          // purpose of this test is to make sure that we have received all the members                       
// that we can expect before the start method returns                                                  // that we can expect before the start method returns                                               
Thread[] threads = new Thread[channels.length];                                                        Thread[] threads = new Thread[channels.length];                                                     
for (int i = 0; i &lt; channels.length; i++) {                                                         for (int i = 0; i &lt; channels.length; i++) {                                                      
final Channel channel = channels[i];                                                                   final Channel channel = channels[i];                                                                
Thread t = new Thread() {                                                                              Thread t = new Thread() {                                                                           
                                                                                                                                                                                                           
@Override                                                                                              @Override                                                                                           
public void run() {                                                                                    public void run() {                                                                                 
try {                                                                                                  try {                                                                                               
channel.start(Channel.DEFAULT);                                                                        channel.start(Channel.DEFAULT);                                                                     
} catch (Exception x) {                                                                                } catch (Exception x) {                                                                             
throw new RuntimeException(x);                                                                         throw new RuntimeException(x);                                                                      
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
};                                                                                                     };                                                                                                  
threads[i] = t;                                                                                        threads[i] = t;                                                                                     
}                                                                                                      }                                                                                                   
for (Thread thread : threads) thread.start();                                                        | for (Thread thread : threads) {                                                                     
for (Thread thread : threads) thread.join();                                                         | thread.start();                                                                                     
                                                                                                     | }                                                                                                   
                                                                                                     | for (Thread thread : threads) {                                                                     
                                                                                                     | thread.join();                                                                                      
                                                                                                     | }                                                                                                   
System.out.println("All channels started.");                                                           System.out.println("All channels started.");                                                        
for (int i = listeners.length - 1; i &gt;= 0; i--) {                                                   for (int i = listeners.length - 1; i &gt;= 0; i--) {                                                
Assert.assertEquals("Checking member arrival length", 0, listeners[i].members.size());                 Assert.assertEquals("Checking member arrival length", 0, listeners[i].members.size());              
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
