/**                                                                                                    /**                                                                                                 
* @param order MessageOrder                                                                            * @param order MessageOrder                                                                         
* @return boolean - true if a message expired and was processed                                        * @return boolean - true if a message expired and was processed                                     
*/                                                                                                     */                                                                                                  
protected boolean processIncoming(MessageOrder order) {                                                protected boolean processIncoming(MessageOrder order) {                                             
boolean result = false;                                                                                boolean result = false;                                                                             
Member member = order.getMessage().getAddress();                                                       Member member = order.getMessage().getAddress();                                                    
Counter cnt = getInCounter(member);                                                                    Counter cnt = getInCounter(member);                                                                 
MessageOrder tmp = incoming.get(member);                                                               MessageOrder tmp = incoming.get(member);                                                            
if (tmp != null) {                                                                                     if (tmp != null) {                                                                                  
order = MessageOrder.add(tmp, order);                                                                  order = MessageOrder.add(tmp, order);                                                               
}                                                                                                      }                                                                                                   
while ((order != null) && (order.getMsgNr() &lt;= cnt.getCounter())) {                                 while ((order != null) && (order.getMsgNr() &lt;= cnt.getCounter())) {                              
// we are right on target. process orders                                                              // we are right on target. process orders                                                           
if (order.getMsgNr() == cnt.getCounter())                                                            | if (order.getMsgNr() == cnt.getCounter()) {                                                         
cnt.inc();                                                                                             cnt.inc();                                                                                          
else if (order.getMsgNr() &gt; cnt.getCounter())                                                     | } else if (order.getMsgNr() &gt; cnt.getCounter()) {                                                
cnt.setCounter(order.getMsgNr());                                                                      cnt.setCounter(order.getMsgNr());                                                                   
                                                                                                     | }                                                                                                   
super.messageReceived(order.getMessage());                                                             super.messageReceived(order.getMessage());                                                          
order.setMessage(null);                                                                                order.setMessage(null);                                                                             
order = order.next;                                                                                    order = order.next;                                                                                 
}                                                                                                      }                                                                                                   
MessageOrder head = order;                                                                             MessageOrder head = order;                                                                          
MessageOrder prev = null;                                                                              MessageOrder prev = null;                                                                           
tmp = order;                                                                                           tmp = order;                                                                                        
// flag to empty out the queue when it larger than maxQueue                                            // flag to empty out the queue when it larger than maxQueue                                         
boolean empty = order != null ? order.getCount() &gt;= maxQueue : false;                               boolean empty = order != null ? order.getCount() &gt;= maxQueue : false;                            
while (tmp != null) {                                                                                  while (tmp != null) {                                                                               
// process expired messages or empty out the queue                                                     // process expired messages or empty out the queue                                                  
if (tmp.isExpired(expire) || empty) {                                                                  if (tmp.isExpired(expire) || empty) {                                                               
// reset the head                                                                                      // reset the head                                                                                   
if (tmp == head)                                                                                     | if (tmp == head) {                                                                                  
head = tmp.next;                                                                                       head = tmp.next;                                                                                    
                                                                                                     | }                                                                                                   
cnt.setCounter(tmp.getMsgNr() + 1);                                                                    cnt.setCounter(tmp.getMsgNr() + 1);                                                                 
if (getForwardExpired())                                                                             | if (getForwardExpired()) {                                                                          
super.messageReceived(tmp.getMessage());                                                               super.messageReceived(tmp.getMessage());                                                            
                                                                                                     | }                                                                                                   
tmp.setMessage(null);                                                                                  tmp.setMessage(null);                                                                               
tmp = tmp.next;                                                                                        tmp = tmp.next;                                                                                     
if (prev != null)                                                                                    | if (prev != null) {                                                                                 
prev.next = tmp;                                                                                       prev.next = tmp;                                                                                    
                                                                                                     | }                                                                                                   
result = true;                                                                                         result = true;                                                                                      
} else {                                                                                               } else {                                                                                            
prev = tmp;                                                                                            prev = tmp;                                                                                         
tmp = tmp.next;                                                                                        tmp = tmp.next;                                                                                     
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
if (head == null)                                                                                    | if (head == null) {                                                                                 
incoming.remove(member);                                                                               incoming.remove(member);                                                                            
else                                                                                                 | } else {                                                                                            
incoming.put(member, head);                                                                            incoming.put(member, head);                                                                         
                                                                                                     | }                                                                                                   
return result;                                                                                         return result;                                                                                      
}                                                                                                      }                                                                                                   
