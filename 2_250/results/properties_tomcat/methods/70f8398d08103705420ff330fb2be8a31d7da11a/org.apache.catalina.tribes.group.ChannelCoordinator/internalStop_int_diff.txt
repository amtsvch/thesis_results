/**                                                                                                    /**                                                                                                 
* Shuts down the channel. This can be called multiple times for individual services to shutdown        * Shuts down the channel. This can be called multiple times for individual services to shutdown     
* The svc parameter can be the logical or value of any constants                                       * The svc parameter can be the logical or value of any constants                                    
* @param svc int value of &lt;BR&gt;                                                                   * @param svc int value of &lt;BR&gt;                                                                
* DEFAULT - will shutdown all services &lt;BR&gt;                                                      * DEFAULT - will shutdown all services &lt;BR&gt;                                                   
* MBR_RX_SEQ - starts the membership receiver &lt;BR&gt;                                               * MBR_RX_SEQ - starts the membership receiver &lt;BR&gt;                                            
* MBR_TX_SEQ - starts the membership broadcaster &lt;BR&gt;                                            * MBR_TX_SEQ - starts the membership broadcaster &lt;BR&gt;                                         
* SND_TX_SEQ - starts the replication transmitter&lt;BR&gt;                                            * SND_TX_SEQ - starts the replication transmitter&lt;BR&gt;                                         
* SND_RX_SEQ - starts the replication receiver&lt;BR&gt;                                               * SND_RX_SEQ - starts the replication receiver&lt;BR&gt;                                            
* @throws ChannelException if a startup error occurs or the service is already started.                * @throws ChannelException if a startup error occurs or the service is already started.             
*/                                                                                                     */                                                                                                  
protected synchronized void internalStop(int svc) throws ChannelException {                            protected synchronized void internalStop(int svc) throws ChannelException {                         
try {                                                                                                  try {                                                                                               
// make sure we don't pass down any flags that are unrelated to the bottom layer                       // make sure we don't pass down any flags that are unrelated to the bottom layer                    
svc = svc & Channel.DEFAULT;                                                                           svc = svc & Channel.DEFAULT;                                                                        
                                                                                                     | if (startLevel == 0) {                                                                              
// we have already stopped up all components                                                           // we have already stopped up all components                                                        
if (startLevel == 0)                                                                                 |                                                                                                     
return;                                                                                                return;                                                                                             
                                                                                                     | }                                                                                                   
                                                                                                     | if (svc == 0) {                                                                                     
// nothing to stop                                                                                     // nothing to stop                                                                                  
if (svc == 0)                                                                                        |                                                                                                     
return;                                                                                                return;                                                                                             
                                                                                                     | }                                                                                                   
boolean valid = false;                                                                                 boolean valid = false;                                                                              
if (Channel.MBR_TX_SEQ == (svc & Channel.MBR_TX_SEQ)) {                                                if (Channel.MBR_TX_SEQ == (svc & Channel.MBR_TX_SEQ)) {                                             
membershipService.stop(MembershipService.MBR_TX);                                                      membershipService.stop(MembershipService.MBR_TX);                                                   
valid = true;                                                                                          valid = true;                                                                                       
}                                                                                                      }                                                                                                   
if (Channel.MBR_RX_SEQ == (svc & Channel.MBR_RX_SEQ)) {                                                if (Channel.MBR_RX_SEQ == (svc & Channel.MBR_RX_SEQ)) {                                             
membershipService.stop(MembershipService.MBR_RX);                                                      membershipService.stop(MembershipService.MBR_RX);                                                   
membershipService.setMembershipListener(null);                                                         membershipService.setMembershipListener(null);                                                      
valid = true;                                                                                          valid = true;                                                                                       
}                                                                                                      }                                                                                                   
if (Channel.SND_TX_SEQ == (svc & Channel.SND_TX_SEQ)) {                                                if (Channel.SND_TX_SEQ == (svc & Channel.SND_TX_SEQ)) {                                             
clusterSender.stop();                                                                                  clusterSender.stop();                                                                               
valid = true;                                                                                          valid = true;                                                                                       
}                                                                                                      }                                                                                                   
if (Channel.SND_RX_SEQ == (svc & Channel.SND_RX_SEQ)) {                                                if (Channel.SND_RX_SEQ == (svc & Channel.SND_RX_SEQ)) {                                             
clusterReceiver.stop();                                                                                clusterReceiver.stop();                                                                             
clusterReceiver.setMessageListener(null);                                                              clusterReceiver.setMessageListener(null);                                                           
valid = true;                                                                                          valid = true;                                                                                       
}                                                                                                      }                                                                                                   
if (!valid) {                                                                                          if (!valid) {                                                                                       
throw new IllegalArgumentException(sm.getString("channelCoordinator.invalid.startLevel"));             throw new IllegalArgumentException(sm.getString("channelCoordinator.invalid.startLevel"));          
}                                                                                                      }                                                                                                   
startLevel = (startLevel & (~svc));                                                                    startLevel = (startLevel & (~svc));                                                                 
setChannel(null);                                                                                      setChannel(null);                                                                                   
} catch (Exception x) {                                                                                } catch (Exception x) {                                                                             
throw new ChannelException(x);                                                                         throw new ChannelException(x);                                                                      
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
