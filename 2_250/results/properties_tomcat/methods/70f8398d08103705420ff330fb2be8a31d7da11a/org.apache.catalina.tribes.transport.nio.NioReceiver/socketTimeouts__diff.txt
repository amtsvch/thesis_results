protected void socketTimeouts() {                                                                      protected void socketTimeouts() {                                                                   
long now = System.currentTimeMillis();                                                                 long now = System.currentTimeMillis();                                                              
if ((now - lastCheck) &lt; getSelectorTimeout())                                                     | if ((now - lastCheck) &lt; getSelectorTimeout()) {                                                  
return;                                                                                                return;                                                                                             
                                                                                                     | }                                                                                                   
// timeout                                                                                             // timeout                                                                                          
Selector tmpsel = this.selector.get();                                                                 Selector tmpsel = this.selector.get();                                                              
Set&lt;SelectionKey&gt; keys = (isListening() && tmpsel != null) ? tmpsel.keys() : null;               Set&lt;SelectionKey&gt; keys = (isListening() && tmpsel != null) ? tmpsel.keys() : null;            
if (keys == null)                                                                                    | if (keys == null) {                                                                                 
return;                                                                                                return;                                                                                             
                                                                                                     | }                                                                                                   
for (SelectionKey key : keys) {                                                                        for (SelectionKey key : keys) {                                                                     
try {                                                                                                  try {                                                                                               
// if (key.interestOps() == SelectionKey.OP_READ) {                                                    // if (key.interestOps() == SelectionKey.OP_READ) {                                                 
// //only timeout sockets that we are waiting for a read from                                          // //only timeout sockets that we are waiting for a read from                                       
// ObjectReader ka = (ObjectReader) key.attachment();                                                  // ObjectReader ka = (ObjectReader) key.attachment();                                               
// long delta = now - ka.getLastAccess();                                                              // long delta = now - ka.getLastAccess();                                                           
// if (delta &gt; (long) getTimeout()) {                                                               // if (delta &gt; (long) getTimeout()) {                                                            
// cancelledKey(key);                                                                                  // cancelledKey(key);                                                                               
// }                                                                                                   // }                                                                                                
// }                                                                                                   // }                                                                                                
// else                                                                                                // else                                                                                             
if (key.interestOps() == 0) {                                                                          if (key.interestOps() == 0) {                                                                       
// check for keys that didn't make it in.                                                              // check for keys that didn't make it in.                                                           
ObjectReader ka = (ObjectReader) key.attachment();                                                     ObjectReader ka = (ObjectReader) key.attachment();                                                  
if (ka != null) {                                                                                      if (ka != null) {                                                                                   
long delta = now - ka.getLastAccess();                                                                 long delta = now - ka.getLastAccess();                                                              
if (delta &gt; getTimeout() && (!ka.isAccessed())) {                                                   if (delta &gt; getTimeout() && (!ka.isAccessed())) {                                                
if (log.isWarnEnabled())                                                                             | if (log.isWarnEnabled()) {                                                                          
log.warn(sm.getString("nioReceiver.threadsExhausted", Integer.valueOf(getTimeout()), Boolean.valueOf   log.warn(sm.getString("nioReceiver.threadsExhausted", Integer.valueOf(getTimeout()), Boolean.valueOf
                                                                                                     | }                                                                                                   
ka.setLastAccess(now);                                                                                 ka.setLastAccess(now);                                                                              
// key.interestOps(SelectionKey.OP_READ);                                                              // key.interestOps(SelectionKey.OP_READ);                                                           
}                                                                                                      }                                                                                                   
// end if                                                                                              // end if                                                                                           
} else {                                                                                               } else {                                                                                            
cancelledKey(key);                                                                                     cancelledKey(key);                                                                                  
}                                                                                                      }                                                                                                   
// end if                                                                                              // end if                                                                                           
}                                                                                                      }                                                                                                   
// end if                                                                                              // end if                                                                                           
} catch (CancelledKeyException ckx) {                                                                  } catch (CancelledKeyException ckx) {                                                               
cancelledKey(key);                                                                                     cancelledKey(key);                                                                                  
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
lastCheck = System.currentTimeMillis();                                                                lastCheck = System.currentTimeMillis();                                                             
}                                                                                                      }                                                                                                   
