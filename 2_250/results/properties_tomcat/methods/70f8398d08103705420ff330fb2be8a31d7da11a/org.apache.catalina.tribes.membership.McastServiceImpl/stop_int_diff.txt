/**                                                                                                    /**                                                                                                 
* Stops the service.                                                                                   * Stops the service.                                                                                
* @param level Stop status                                                                             * @param level Stop status                                                                          
* @return &lt;code&gt;true&lt;/code&gt; if the stop is complete                                        * @return &lt;code&gt;true&lt;/code&gt; if the stop is complete                                     
* @throws IOException if the service fails to disconnect from the sockets                              * @throws IOException if the service fails to disconnect from the sockets                           
*/                                                                                                     */                                                                                                  
@Override                                                                                              @Override                                                                                           
public synchronized boolean stop(int level) throws IOException {                                       public synchronized boolean stop(int level) throws IOException {                                    
boolean valid = false;                                                                                 boolean valid = false;                                                                              
if ((level & Channel.MBR_RX_SEQ) == Channel.MBR_RX_SEQ) {                                              if ((level & Channel.MBR_RX_SEQ) == Channel.MBR_RX_SEQ) {                                           
valid = true;                                                                                          valid = true;                                                                                       
doRunReceiver = false;                                                                                 doRunReceiver = false;                                                                              
if (receiver != null)                                                                                | if (receiver != null) {                                                                             
receiver.interrupt();                                                                                  receiver.interrupt();                                                                               
                                                                                                     | }                                                                                                   
receiver = null;                                                                                       receiver = null;                                                                                    
}                                                                                                      }                                                                                                   
if ((level & Channel.MBR_TX_SEQ) == Channel.MBR_TX_SEQ) {                                              if ((level & Channel.MBR_TX_SEQ) == Channel.MBR_TX_SEQ) {                                           
valid = true;                                                                                          valid = true;                                                                                       
doRunSender = false;                                                                                   doRunSender = false;                                                                                
if (sender != null)                                                                                  | if (sender != null) {                                                                               
sender.interrupt();                                                                                    sender.interrupt();                                                                                 
                                                                                                     | }                                                                                                   
sender = null;                                                                                         sender = null;                                                                                      
}                                                                                                      }                                                                                                   
if (!valid) {                                                                                          if (!valid) {                                                                                       
throw new IllegalArgumentException(sm.getString("mcastServiceImpl.invalid.stopLevel"));                throw new IllegalArgumentException(sm.getString("mcastServiceImpl.invalid.stopLevel"));             
}                                                                                                      }                                                                                                   
startLevel = (startLevel & (~level));                                                                  startLevel = (startLevel & (~level));                                                               
// we're shutting down, send a shutdown message and close the socket                                   // we're shutting down, send a shutdown message and close the socket                                
if (startLevel == 0) {                                                                                 if (startLevel == 0) {                                                                              
// send a stop message                                                                                 // send a stop message                                                                              
member.setCommand(Member.SHUTDOWN_PAYLOAD);                                                            member.setCommand(Member.SHUTDOWN_PAYLOAD);                                                         
send(false);                                                                                           send(false);                                                                                        
// leave mcast group                                                                                   // leave mcast group                                                                                
try {                                                                                                  try {                                                                                               
socket.leaveGroup(address);                                                                            socket.leaveGroup(address);                                                                         
} catch (Exception ignore) {                                                                           } catch (Exception ignore) {                                                                        
}                                                                                                      }                                                                                                   
try {                                                                                                  try {                                                                                               
socket.close();                                                                                        socket.close();                                                                                     
} catch (Exception ignore) {                                                                           } catch (Exception ignore) {                                                                        
}                                                                                                      }                                                                                                   
member.setServiceStartTime(-1);                                                                        member.setServiceStartTime(-1);                                                                     
}                                                                                                      }                                                                                                   
return (startLevel == 0);                                                                              return (startLevel == 0);                                                                           
}                                                                                                      }                                                                                                   
