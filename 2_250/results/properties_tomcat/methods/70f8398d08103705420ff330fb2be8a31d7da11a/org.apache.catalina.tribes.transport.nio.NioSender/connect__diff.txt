/**                                                                                                    /**                                                                                                 
* connect - blocking in this operation                                                                 * connect - blocking in this operation                                                              
*                                                                                                      *                                                                                                   
* @throws IOException                                                                                  * @throws IOException                                                                               
* TODO Implement this org.apache.catalina.tribes.transport.IDataSender method                          * TODO Implement this org.apache.catalina.tribes.transport.IDataSender method                       
*/                                                                                                     */                                                                                                  
@Override                                                                                              @Override                                                                                           
public synchronized void connect() throws IOException {                                                public synchronized void connect() throws IOException {                                             
if (connecting || isConnected())                                                                     | if (connecting || isConnected()) {                                                                  
return;                                                                                                return;                                                                                             
                                                                                                     | }                                                                                                   
connecting = true;                                                                                     connecting = true;                                                                                  
if (isConnected())                                                                                   | if (isConnected()) {                                                                                
throw new IOException(sm.getString("nioSender.already.connected"));                                    throw new IOException(sm.getString("nioSender.already.connected"));                                 
                                                                                                     | }                                                                                                   
if (readbuf == null) {                                                                                 if (readbuf == null) {                                                                              
readbuf = getReadBuffer();                                                                             readbuf = getReadBuffer();                                                                          
} else {                                                                                               } else {                                                                                            
readbuf.clear();                                                                                       readbuf.clear();                                                                                    
}                                                                                                      }                                                                                                   
if (writebuf == null) {                                                                                if (writebuf == null) {                                                                             
writebuf = getWriteBuffer();                                                                           writebuf = getWriteBuffer();                                                                        
} else {                                                                                               } else {                                                                                            
writebuf.clear();                                                                                      writebuf.clear();                                                                                   
}                                                                                                      }                                                                                                   
if (isUdpBased()) {                                                                                    if (isUdpBased()) {                                                                                 
InetSocketAddress daddr = new InetSocketAddress(getAddress(), getUdpPort());                           InetSocketAddress daddr = new InetSocketAddress(getAddress(), getUdpPort());                        
if (dataChannel != null)                                                                             | if (dataChannel != null) {                                                                          
throw new IOException(sm.getString("nioSender.datagram.already.established"));                         throw new IOException(sm.getString("nioSender.datagram.already.established"));                      
                                                                                                     | }                                                                                                   
dataChannel = DatagramChannel.open();                                                                  dataChannel = DatagramChannel.open();                                                               
configureSocket();                                                                                     configureSocket();                                                                                  
dataChannel.connect(daddr);                                                                            dataChannel.connect(daddr);                                                                         
completeConnect();                                                                                     completeConnect();                                                                                  
dataChannel.register(getSelector(), SelectionKey.OP_WRITE, this);                                      dataChannel.register(getSelector(), SelectionKey.OP_WRITE, this);                                   
} else {                                                                                               } else {                                                                                            
InetSocketAddress addr = new InetSocketAddress(getAddress(), getPort());                               InetSocketAddress addr = new InetSocketAddress(getAddress(), getPort());                            
if (socketChannel != null)                                                                           | if (socketChannel != null) {                                                                        
throw new IOException(sm.getString("nioSender.socketChannel.already.established"));                    throw new IOException(sm.getString("nioSender.socketChannel.already.established"));                 
                                                                                                     | }                                                                                                   
socketChannel = SocketChannel.open();                                                                  socketChannel = SocketChannel.open();                                                               
configureSocket();                                                                                     configureSocket();                                                                                  
if (socketChannel.connect(addr)) {                                                                     if (socketChannel.connect(addr)) {                                                                  
completeConnect();                                                                                     completeConnect();                                                                                  
socketChannel.register(getSelector(), SelectionKey.OP_WRITE, this);                                    socketChannel.register(getSelector(), SelectionKey.OP_WRITE, this);                                 
} else {                                                                                               } else {                                                                                            
socketChannel.register(getSelector(), SelectionKey.OP_CONNECT, this);                                  socketChannel.register(getSelector(), SelectionKey.OP_CONNECT, this);                               
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
