public int countPackages(boolean first) {                                                              public int countPackages(boolean first) {                                                           
int cnt = 0;                                                                                           int cnt = 0;                                                                                        
int pos = START_DATA.length;                                                                           int pos = START_DATA.length;                                                                        
int start = 0;                                                                                         int start = 0;                                                                                      
while (start &lt; bufSize) {                                                                           while (start &lt; bufSize) {                                                                        
// first check start header                                                                            // first check start header                                                                         
int index = XByteBuffer.firstIndexOf(buf, start, START_DATA);                                          int index = XByteBuffer.firstIndexOf(buf, start, START_DATA);                                       
// if the header (START_DATA) isn't the first thing or                                                 // if the header (START_DATA) isn't the first thing or                                              
// the buffer isn't even 14 bytes                                                                      // the buffer isn't even 14 bytes                                                                   
if (index != start || ((bufSize - start) &lt; 14))                                                   | if (index != start || ((bufSize - start) &lt; 14)) {                                                
break;                                                                                                 break;                                                                                              
                                                                                                     | }                                                                                                   
// next 4 bytes are compress flag not needed for count packages                                        // next 4 bytes are compress flag not needed for count packages                                     
// then get the size 4 bytes                                                                           // then get the size 4 bytes                                                                        
int size = toInt(buf, pos);                                                                            int size = toInt(buf, pos);                                                                         
// now the total buffer has to be long enough to hold                                                  // now the total buffer has to be long enough to hold                                               
// START_DATA.length+4+size+END_DATA.length                                                            // START_DATA.length+4+size+END_DATA.length                                                         
pos = start + START_DATA.length + 4 + size;                                                            pos = start + START_DATA.length + 4 + size;                                                         
if ((pos + END_DATA.length) &gt; bufSize)                                                            | if ((pos + END_DATA.length) &gt; bufSize) {                                                         
break;                                                                                                 break;                                                                                              
                                                                                                     | }                                                                                                   
// and finally check the footer of the package END_DATA                                                // and finally check the footer of the package END_DATA                                             
int newpos = firstIndexOf(buf, pos, END_DATA);                                                         int newpos = firstIndexOf(buf, pos, END_DATA);                                                      
// mismatch, there is no package                                                                       // mismatch, there is no package                                                                    
if (newpos != pos)                                                                                   | if (newpos != pos) {                                                                                
break;                                                                                                 break;                                                                                              
                                                                                                     | }                                                                                                   
// increase the packet count                                                                           // increase the packet count                                                                        
cnt++;                                                                                                 cnt++;                                                                                              
// reset the values                                                                                    // reset the values                                                                                 
start = pos + END_DATA.length;                                                                         start = pos + END_DATA.length;                                                                      
pos = start + START_DATA.length;                                                                       pos = start + START_DATA.length;                                                                    
// we only want to verify that we have at least one package                                            // we only want to verify that we have at least one package                                         
if (first)                                                                                           | if (first) {                                                                                        
break;                                                                                                 break;                                                                                              
}                                                                                                      }                                                                                                   
                                                                                                     | }                                                                                                   
return cnt;                                                                                            return cnt;                                                                                         
}                                                                                                      }                                                                                                   
